<!DOCTYPE html>
<!--
Adapted from JavaScript, 9th edition
by Tom Negrino and Dori Smith
PeachPit Press, 2015
ISBN 978-0-321-99670-1
-->
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>JavaScript Bingo</title>
    <link rel="stylesheet" href="index_files/bingo.css">
    <!--<script type="text/javascript" src="index_files/bingo.js"></script>-->
    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
    var socket = io();    
    $( document ).ready(function() {

        // When join button is clicked
        $("#btnJoin").click(function() {
            var playerName = $("input[name=player_name").val();
            joinGame(playerName);
        });

        // When claim victory button is clicked
        $("#btnClaimVictory").click(function() {
            claimVictory();
        });

        // Notify the server, gets and display the board
        function joinGame(playerName) {
            console.log(playerName);
            socket.emit('joined game', playerName);
            var numberOfRows = 3;
            var numberOfColumns = 9;
            var boardTable = $("<table>");
            boardTable.attr("id", "board");
            var tileId = 0;
            // Create the rows
            for(var i = 0; i < numberOfRows; i++) {
                var row = $("<tr>");
                // Create the "tiles"
                for(var j = 0; j < numberOfColumns; j++) {
                    var tile = $("<td>");
                    tile.attr("id", tileId);
                    tile.text("TBD");
                    row.append(tile);
                    tileId++;
                    // Toggle the select class when clicked
                    tile.click(function() {
                        $(this).toggleClass("selected");
                    });
                }
                boardTable.append(row);
            }
            $("#boardContainer").html(boardTable);
        }

        socket.on('game numbers', function(msg) {
            $('#numbersContainer').text(msg);
        });

        socket.on('user messages'), function(msg) {
            $('#userMessages').append($('<li>').text(msg));
        }

        function claimVictory() {
            var selectedNumberList = [];
            $(".selected").each(function() {
                var square = $(this);
                var selectedNumber = {};
                selectedNumber.id = square.attr("id");
                selectedNumber.number = square.html();
                selectedNumberList.push(selectedNumber);
            });
            alert(JSON.stringify(selectedNumberList));
        }

        //
        //function getBoard() {
            //$.get( "ajax/test.html", function( data ) {
                //$( ".result" ).html( data );
                //alert( "Load was performed." );
            //});

            //return xyz;
        //}
    });



    </script>


</head>
<body>

    Name: <input type="text" name="player_name">
    <button id="btnJoin">Join Bingo</button>

    <div id="numbersContainer">X</div>
    <ul id="userMessages">Y</ul>

    <h1>JavaScript Bingo</h1>
    <div id="boardContainer"></div>
    <button id="btnClaimVictory">Claim victory</button>

</body>
</html>